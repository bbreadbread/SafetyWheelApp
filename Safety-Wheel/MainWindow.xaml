<Controls:MetroWindow x:Class="Safety_Wheel.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Safety_Wheel"
        xmlns:Controls="http://metro.mahapps.com/winfx/xaml/controls"
        xmlns:valid="clr-namespace:Safety_Wheel.ValidationRules"
        mc:Ignorable="d"
        Title="Безопасное колесо" 
        WindowState="Maximized"
        WindowTitleBrush="{StaticResource DarkBlue}"
        GlowBrush="DarkBlue"
        BorderBrush="{StaticResource DarkBlue}"
         Closing="MainWindow_Closing">
    <Window.Resources>
        <ControlTemplate x:Key="validationTemplate">
            <StackPanel>
                <Border BorderBrush="Red" BorderThickness="1">
                    <AdornedElementPlaceholder x:Name="adorner"/>
                </Border>
                <TextBlock Text="{Binding [0].ErrorContent}"
                       Foreground="Red" FontSize="11"
                       Margin="5,2,0,0"/>
            </StackPanel>
        </ControlTemplate>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="80"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0" 
                Background="#FFD9D9D9"
                VerticalAlignment="Top"
                Height="80">
            <Border.Effect>
                <DropShadowEffect 
                    ShadowDepth="3"
                    BlurRadius="10"
                    Opacity="0.3"
                    Color="Black"/>
            </Border.Effect>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <TextBlock  Grid.Column="0"
                            Foreground="#FF052D6E"
                            FontSize="48"
                            FontWeight="Bold"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Left"
                            Margin="80,0,0,0"
                            Text="{Binding UserFullName}"/>


                <StackPanel Grid.Column="1" 
                            Height="80"
                           Orientation="Horizontal"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Right"
                           Background="{StaticResource DarkBlue}">

                    <Image x:Name="BackImage" 
                          Source="pack://application:,,,/Images/back_logo.png"
                          Width="60" 
                          Height="60"
                          Margin="30,0,15,0"
                          Cursor="Hand"
                           MouseDown="BackImage_MouseDown"/>

                    <Image x:Name="ExitImage" 
                          Source="pack://application:,,,/Images/exit_logo.png"
                          Width="60" 
                          Height="60"
                          Cursor="Hand"
                           Margin="15,0,30,0"
                          MouseDown="ExitImage_MouseDown"/>

                </StackPanel>
            </Grid>
        </Border>

        <Frame x:Name="MainFrame" 
               Grid.Row="1"
               NavigationUIVisibility="Hidden"
               HorizontalAlignment="Stretch"
               VerticalAlignment="Stretch"
               Source="Pages/Student/AuthorizationPage.xaml"/>
    </Grid>

    <Controls:MetroWindow.Flyouts>
        <Controls:FlyoutsControl>

            <Controls:Flyout x:Name="TeacherManagerFlyout"
                     Header="Управление учениками"
                     Position="Right"
                     Width="450"
                     IsOpen="False"
                     IsPinned="True"
                     Background="{StaticResource MainBlue}"
                     IsOpenChanged="TeacherManagerFlyout_IsOpenChanged">
                <ScrollViewer>
                    <Grid Margin="15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10" HorizontalAlignment="Center" Grid.Row="1">
                        <Button Style="{StaticResource MiniMiniHomeButton}" Content="Добавить" Click="AddStudent_Click"/>
                        <Button Style="{StaticResource MiniMiniHomeButton}" Content="Сохранить" Click="SaveStudent_Click" Margin="10,0"/>
                        <Button Style="{StaticResource MiniMiniHomeButton}" Content="Удалить" Click="DeleteStudent_Click"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Row="2" Margin="0,0,0,10"  x:Name="StudentInputsPanel">
                        <Label>Имя</Label>
                        <TextBox x:Name="NameTextBox"
                                    Background="White"
                                    Foreground="Black"
                                    Validation.ErrorTemplate="{StaticResource validationTemplate}">
                            <TextBox.Text>
                                <Binding Path="StudentName" UpdateSourceTrigger="PropertyChanged">
                                    <Binding.ValidationRules>
                                        <valid:NameValidationRule/>
                                    </Binding.ValidationRules>
                                </Binding>
                            </TextBox.Text>
                        </TextBox>

                        <Label>Логин</Label>
                        <TextBox x:Name="LoginTextBox"
                                  Background="White"
                                  Foreground="Black"
                                  Validation.ErrorTemplate="{StaticResource validationTemplate}">       
                            <TextBox.Text>
                                <Binding Path="StudentLogin"
                                         UpdateSourceTrigger="PropertyChanged">
                                    <Binding.ValidationRules>
                                        <valid:LoginUniqueValidationRule x:Name="StudentLoginRule"/>
                                    </Binding.ValidationRules>
                                </Binding>
                            </TextBox.Text>
                        </TextBox>

                        <Label>Пароль</Label>
                        <TextBox x:Name="PasswordTextBox"
                                  Background="White"
                                  Foreground="Black"
                                  Validation.ErrorTemplate="{StaticResource validationTemplate}">
                            <TextBox.Text>
                                <Binding Path="StudentPassword"
          UpdateSourceTrigger="PropertyChanged">
                                    <Binding.ValidationRules>
                                        <valid:RequiredFieldValidationRule/>
                                    </Binding.ValidationRules>
                                </Binding>
                            </TextBox.Text>
                        </TextBox>
                    </StackPanel>


                    <DataGrid x:Name="StudentsGrid"
                               Grid.Row="3"
                               IsReadOnly="True"
                               SelectionMode="Single"
                               SelectionUnit="FullRow"
                               AutoGenerateColumns="False"
                               SelectionChanged="StudentsGrid_SelectionChanged">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Имя Фамилия" Binding="{Binding Name}" />
                            <DataGridTextColumn Header="Логин" Binding="{Binding Login}" />
                            <DataGridTextColumn Header="Пароль" Binding="{Binding Password}" />
                        </DataGrid.Columns>
                    </DataGrid>
                    <Border Grid.Row="0"
                             Margin="0,10"
                             Padding="10"
                             Background="#33000000"
                             CornerRadius="8">

                        <StackPanel x:Name="TeacherInputsPanel">
                            <TextBlock Text="Профиль преподавателя"
                                FontWeight="Bold"
                                FontSize="16"
                                Margin="0,0,0,8"/>

                            <TextBlock Text="Имя"/>
                            <TextBox x:Name="TeacherNameTextBox"
                                      Background="White"
                                      Foreground="Black"
                                      Validation.ErrorTemplate="{StaticResource validationTemplate}">
                                <TextBox.Text>
                                    <Binding Path="TeacherName"
          UpdateSourceTrigger="PropertyChanged">
                                        <Binding.ValidationRules>
                                            <valid:NameValidationRule/>
                                        </Binding.ValidationRules>
                                    </Binding>
                                </TextBox.Text>
                            </TextBox>

                            <TextBlock Text="Логин" Margin="0,5,0,0"/>
                            <TextBox x:Name="TeacherLoginTextBox"
                                      Background="White"
                                      Foreground="Black"
                                      Validation.ErrorTemplate="{StaticResource validationTemplate}">
                                <TextBox.Text>
                                    <Binding Path="TeacherLogin"
          UpdateSourceTrigger="PropertyChanged">
                                        <Binding.ValidationRules>
                                            <valid:TeacherLoginValidationRule x:Name="TeacherLoginRule"/>
                                        </Binding.ValidationRules>
                                    </Binding>
                                </TextBox.Text>
                            </TextBox>

                            <TextBlock Text="Пароль" Margin="0,5,0,0"/>
                            <TextBox x:Name="TeacherPasswordTextBox"
                                      Background="White"
                                      Foreground="Black"
                                      Validation.ErrorTemplate="{StaticResource validationTemplate}">
                                <TextBox.Text>
                                    <Binding Path="TeacherPassword"
          UpdateSourceTrigger="PropertyChanged">
                                        <Binding.ValidationRules>
                                            <valid:TeacherRequiredValidationRule/>
                                        </Binding.ValidationRules>
                                    </Binding>
                                </TextBox.Text>
                            </TextBox>
                            <Button Content="Изменить данные"
                             Style="{StaticResource MiniMiniHomeButton}"
                             Margin="0,10,0,0"
                             HorizontalAlignment="Right"
                             Click="UpdateTeacher_Click"/>
                        </StackPanel>
                    </Border>
                </Grid>
                </ScrollViewer>
                
            </Controls:Flyout>

            <Controls:Flyout x:Name="FilterMonthFlyout"
                     Header="Фильтр по месяцу"
                     Position="Right"
                     Width="300"
                     IsPinned="True"
                     Background="{StaticResource MainBlue}">

                <StackPanel Margin="20">

                    <TextBlock Text="Год"
                       Margin="0,0,0,5"/>

                    <TextBox x:Name="YearTextBox"
                     Height="40"
                     PreviewTextInput="YearTextBox_PreviewTextInput"/>

                    <TextBlock Text="Месяц"
                       Margin="0,15,0,5"/>

                    <ComboBox x:Name="MonthComboBox"
                              Background="White"
                              Foreground="Black"
                              Height="30"
                              DisplayMemberPath="Name"
                              SelectedValuePath="Number"
                              SelectionChanged="MonthComboBox_SelectionChanged"/>

                    <Button Content="Применить"
                            Margin="0,20,0,0"
                            Height="35"
                            Command="{Binding ApplyMonthFilterCommand}" />

                    <Button Content="Сбросить"
                            Margin="0,10,0,0"
                            Height="30"
                            Command="{Binding ResetMonthFilterCommand}" />

                </StackPanel>
            </Controls:Flyout>
        </Controls:FlyoutsControl>
    </Controls:MetroWindow.Flyouts>
</Controls:MetroWindow>