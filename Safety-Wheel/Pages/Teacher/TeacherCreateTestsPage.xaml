<UserControl x:Class="Safety_Wheel.Pages.Teacher.TeacherCreateTestsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:Safety_Wheel.ViewModels"
             xmlns:conv="clr-namespace:Safety_Wheel.Converters"
             Style="{StaticResource CreateEditTest}">

    <UserControl.Resources>
        <conv:BoolToOpacityConverter x:Key="BoolToOpacity"/>
        <conv:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
        <conv:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibility"/>
    </UserControl.Resources>

    <UserControl.DataContext>
        <vm:TeacherCreateTestViewModel/>
    </UserControl.DataContext>

    <ScrollViewer Height="900">
        <StackPanel Margin="20">

            <TextBlock Text="Дисциплина"
           FontWeight="Bold"
           Margin="0,0,0,5"/>

            <ComboBox ItemsSource="{Binding Subjects}"
          SelectedItem="{Binding SelectedSubject}"
          DisplayMemberPath="Name"
          Margin="0,0,0,15"
                      Style="{DynamicResource CBStyle}"/>

            
            <TextBox Text="{Binding Test.Name, UpdateSourceTrigger=PropertyChanged}"
                     Style="{DynamicResource TBoxStyle}"/>

            <ItemsControl ItemsSource="{Binding Questions}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="0,15"
                                Padding="10"
                                BorderBrush="Gray"
                                BorderThickness="2"
                                CornerRadius="3"
                                Opacity="{Binding IsGhost,
                                    Converter={StaticResource BoolToOpacity}}">
                            <StackPanel>

                                <CheckBox Content="Варианты ответов в виде изображений"
                                          IsChecked="{Binding IsMultiImage}"
                                          Style="{StaticResource CheckBStyle}"/>

                                <TextBox Text="{Binding Text, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{DynamicResource TBoxStyle}"/>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="75"/>
                                    </Grid.RowDefinitions>
                                    <ItemsControl ItemsSource="{Binding Options}" Grid.Column="0">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal"
                                                        Margin="0,3"
                                                        Opacity="{Binding IsGhost,
                                                                  Converter={StaticResource BoolToOpacity}}">


                                                    <CheckBox IsChecked="{Binding IsCorrect, Mode=TwoWay}"/>

                                                    <TextBox Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                                                             Visibility="{Binding IsImageOption,
                                                             Converter={StaticResource InverseBoolToVisibility}}"
                                                             Style="{DynamicResource TBoxStyle}"
                                                             Width="400"/>

                                                    <Button Content="📷"
                                                        Click="AddOptionImage_Click"
                                                        Tag="{Binding}"
                                                        Visibility="{Binding IsImageOption,
                                                            Converter={StaticResource BoolToVisibility}}"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>


                                    <Border  Grid.Column="1"
                                             Background="{StaticResource LightBlue}"
                                             BorderBrush="Gray"
                                             BorderThickness="2"
                                             CornerRadius="3">
                                        <Button Tag="{Binding}"
                                                Visibility="{Binding IsSingleImage,
                                                Converter={StaticResource BoolToVisibility}}"
                                                Click="AddQuestionImage_Click"
                                                Padding="0"
                                                Height="350"
                                                Width="350">
                                            <Image Source="{Binding PicturePath}"
                                                    Height="350"
                                                    Width="350"
                                            Margin="0,5"/>
                                        </Button>
                                    </Border>

                                    <TextBox Text="{Binding Comments, UpdateSourceTrigger=PropertyChanged}"
                                             FontSize="16"
                                             Style="{DynamicResource TBoxStyle}"
                                             Grid.ColumnSpan="2"
                                             Grid.Row="1"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <Button Content="СОХРАНИТЬ ТЕСТ"
                    Margin="0,20"
                    Click="Save_Click"/>

        </StackPanel>
    </ScrollViewer>
</UserControl>
